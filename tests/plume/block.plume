/// Test macro & block call (1 param)
macro double(write)
  $write $write
end
@double
  wing
end
/// Output
wing wing
/// End

/// Test macro & block call (2 params) 1
macro nib(write, paint)
  $write $paint
end
@nib
  - ink
  - quill
end
/// Output
ink quill
/// End

/// Test macro & block call (2 params) 2
macro nib(write, paint)
  $write $paint
end
@nib(quill)
  - Bar
end
/// Output
quill Bar
/// End

/// Test macro & block call (2 params) 3
macro nib(write, paint)
  $write $paint
end
@nib(quill)
  Bar
end
/// Output
quill Bar
/// End

/// Test macro & block call (miwriteed params)
macro nib(write, paint, optn: value)
  $write, $paint, $optn
end
@nib(quill, optn: baz)
  Bar
end
/// Output
quill Bar baz
/// End

/// Test macro & block call (miwriteed params)
macro nib(write, paint, optn: value)
  $write $paint $optn
end
@nib(quill, Bar)
  optn: baz
end
/// Output
quill Bar baz
/// End

/// Test FOR VALUE
let t = for i in seq(5)
  - $(2*i)
end
$t[2]
/// Output
4
/// End

/// Test WHILE VALUE
let i = 100
let t = while i>0
  - $i
  set i -= 1
end
$t[2]
/// Output
99
/// End

/// Test IF auto balance (text)
let x = if false
  Wing
end
$(x == empty)
/// Output
true
/// End

/// Test IF auto balance (table)
let x = if false
  - Wing
end
$(type(x))\n
$(len(x))
/// Output
table
0
/// End

/// Test IF auto unbalanced 1
let x = if true
  - Wing
else
  Nib
end
/// Error
Syntax error: Mixed block: The previous branches of this if statement were of type TABLE, but this else body is of type TEXT.
All branches of an if statement must be of the same type.
File 'IF auto unbalanced 1', line 4: Nib
                                     ^^^
/// End

/// Test IF auto unbalanced 2
let x = if true
  Wing
else
  - Nib
end
/// Error
Syntax error: Mixed block: The previous branches of this if statement were of type VALUE, but this else body is of type TABLE.
All branches of an if statement must be of the same type.
File 'IF auto unbalanced 2', line 4: - Nib
                                     ^^^^^
/// End

/// Test IF auto unbalanced 3
let x = if true
  Wing
elseif false
  Foo
else
  - Nib
end
/// Error
Syntax error: Mixed block: The previous branches of this if statement were of type TEXT, but this else body is of type TABLE.
All branches of an if statement must be of the same type.
File 'IF auto unbalanced 3', line 6: - Nib
                                     ^^^^^
/// End

/// Test IF auto unbalanced 4
let x = if true
  Wing
elseif false
  - Foo
else
  - Nib
end
/// Error
Syntax error: Mixed block: The previous branches of this if statement were of type VALUE, but this elseif body is of type TABLE.
All branches of an if statement must be of the same type.
File 'IF auto unbalanced 4', line 4: - Foo
                                     ^^^^^
/// End
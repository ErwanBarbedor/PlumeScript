/// Test simple affectation
let _write = quill
/// Output
/// End

/// Test simple affectation and eval
let _write = quill
$_write
/// Output
quill
/// End

/// Test shadowing
let _write = 1
if 1==1
	let _write = 2
end
$_write
/// Output
1
/// End

/// Test not shadowing
let _write = 1
if 1==1
	set _write = 2
end
$_write
/// Output
2
/// End

/// Test block capture: if 1
let _write = if 1==1
	5
else
	3
end
$_write
/// Output
5
/// End

/// Test block capture: if 2
let _write = if 1==2
	5
else
	3
end
$_write
/// Output
3
/// End

/// Test block capture: while
let i = 0
let _write = while i<5
	$i
	set i = $(i+1)
end
$_write
/// Output
01234
/// End

/// Test lexical offset 1
let x = 0
@join
	let y=0
	$(x+y)
end
/// Output
0
/// End

/// Test lexical offset 2
let x = 0
@join
	let y=0
	@join
		let z=0
		$(x+y+z)
	end
end
/// Output
0
/// End

/// Test use 1
use tests/plume/toimport/lib
$nib
/// Output
quill
/// End

/// Test wrong indentifier
let if = 5
/// Error
Syntax error: Cannot use 'if' as identifier.
File 'wrong indentifier', line 1: let if = 5
                                      ^^
/// End

/// Test unknow use
use idontexists
/// Error
Compilation error: Cannot open 'idontexists'.
Paths tried:
	main/idontexists.plume
	main/idontexists/init.plume
	idontexists.plume
	idontexists/init.plume
File 'unknow use', line 1: use idontexists
                               ^^^^^^^^^^^
/// End

/// Test use crash
use tests/plume/toimport/badlib
/// Error
Compilation error: Error when executing 'tests/plume/toimport/badlib':
Runtime error: Cannot convert the string value to a number.

Traceback (most recent call first):
  File 'tests/plume/toimport/badlib.plume', line 2: set x += a
                                                        ^
File 'use crash', line 1: use tests/plume/toimport/badlib
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/// End

/// Test use not a table
use tests/plume/toimport/text
/// Error
Compilation error: To be used, 'tests/plume/toimport/text' must return a table. Currently, it returns a string.
File 'use not a table', line 1: use tests/plume/toimport/text
                                    ^^^^^^^^^^^^^^^^^^^^^^^^^
/// End

/// Test already exists 1
let static nib
use tests/plume/toimport/lib
/// Error
Compilation error: Cannot define static variable 'nib' from lib 'tests/plume/toimport/lib', it already exists in the current file scope.
File 'already exists 1', line 2: use tests/plume/toimport/lib
                                     ^^^^^^^^^^^^^^^^^^^^^^^^
/// End

/// Test already exists 2
use tests/plume/toimport/lib
let static nib
/// Error
Compilation error: Cannot define static variable 'nib', it already exists in the current file scope (imported from 'tests/plume/toimport/lib').
File 'already exists 2', line 2: let static nib
                                 ^^^^^^^^^^^^^^
/// End
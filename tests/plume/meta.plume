/// Test addr
let t = @table
  meta addr: macro(x)
    $(x+1)
  end
end
$(t+1)
/// Output
2
/// End

/// Test addl
let t = @table
  meta addl: macro(x)
    $(x+1)
  end
end
$(1+t)
/// Output
2
/// End

/// Test add fallback 1
let t = @table
  meta add: macro(x, y)
    $(y+1)
  end
end
$(t+1)
/// Output
2
/// End

/// Test add fallback 2
let t = @table
  meta add: macro(x, y)
    $(x+1)
  end
end
$(1+t)
/// Output
2
/// End

/// Test self access
let t = @table
  value: 10
  meta add: macro(x, y)
    $(self.value+y)
  end
end
$(t+1)
/// Output
11
/// End

/// Test mul
let t = @table
  meta mulr: macro(x)
    $(x+1)
  end
end
$(t*2)
/// Output
3
/// End

/// Test sub
let t = @table
  meta subr: macro(x)
    $(x+1)
  end
end
$(t-2)
/// Output
3
/// End

/// Test div
let t = @table
  meta divr: macro(x)
    $(x+1)
  end
end
$(t/2)
/// Output
3
/// End

/// Test pow
let t = @table
  meta powr: macro(x)
    $(x+1)
  end
end
$(t^2)
/// Output
3
/// End

/// Test mod
let t = @table
  meta modr: macro(x)
    $(x+1)
  end
end
$(t%2)
/// Output
3
/// End

/// Test minus
let t = @table
  meta minus: macro()
    $(-1)
  end
end
$(-t)
/// Output
-1
/// End

/// Test call
let t = @table
  meta call: macro()
    I'm a called table
  end
end

$t()
/// Output
I'm a called table
/// End

/// Test call with self
let t = @table
  value: 5
  meta call: macro()
    My value is $self.value
  end
end

$t()
/// Output
My value is 5
/// End

/// Test eq
let t = @table
  meta eq: macro(x, y)
    $true
  end
end

$(t==6)
/// Output
true
/// End

/// Test neq fallback
let t = @table
  meta eq: macro(x, y)
    $true
  end
end

$(t!=6)
/// Output
false
/// End

/// Test lt
let t = @table
  meta lt: macro(x, y)
    $true
  end
end

$(t<6)
/// Output
true
/// End

/// Test lt fallback 1
let t = @table
  meta lt: macro(x, y)
    $true
  end
end

$(t>6)
/// Output
true
/// End

/// Test lt fallback 2
let t = @table
  meta lt: macro(x, y)
    $true
  end
end

$(t>=6)
/// Output
false
/// End

/// Test tostring 1
let t = @table
  meta tostring: macro()
    I'm a table
  end
end

t says "$t".
/// Output
t says "I'm a table".
/// End

/// Test tostring 2
let t = @table
  meta tostring: macro()
    I'm a table
  end
end

$(tostring(t))
/// Output
I'm a table
/// End

/// Test tonumber 1
let t = @table
  meta tonumber: macro()
    5
  end
end

$(t+1)
/// Output
6
/// End

/// Test tonumber 2
let t = @table
  meta tonumber: macro()
    5
  end
end

$tonumber($t)
/// Output
5
/// End

/// Test getindex 1
let t = @table
  meta getindex: macro(name)
    WING
  end
end

$t.quill\n
$t.nib
/// Output
WING
WING
/// End

/// Test getindex 2
let t = @table
  meta getindex: macro(name)
    $name
  end
end

$t.quill\n
$t.nib
/// Output
quill
nib
/// End

/// Test setindex 1
let static side = 0
let t = @table
  meta setindex: macro(name, value)
    set side = 1
  end
end
$side
set t.quill = 5
$side
/// Output
01
/// End

/// Test setindex 2
let static side = 0
let t = @table
  meta setindex: macro(name, value)
    set side = 1
  end
end
$side
$rawset($t, quill, 5)
$side
$t.quill
/// Output
005
/// End